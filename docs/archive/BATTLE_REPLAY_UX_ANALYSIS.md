# Анализ UX страницы реплея боя

## Текущее состояние

### Структура страницы
```
┌─────────────────────────────────────────────────────────────────┐
│ Header: Игрок 1 | Игрок 2 | Победитель | Статус                 │
├─────────────────────────────────────────────────────────────────┤
│ Turn Order Bar: Раунд N | Живых юнитов: X                       │
│ [Unit icons sorted by initiative with HP bars]                  │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────────────────┐  ┌──────────────────────────┐  │
│  │     Поле боя (8×10)         │  │   Журнал событий         │  │
│  │                             │  │                          │  │
│  │  0,0  1,0  2,0  3,0 ...     │  │   Раунд 1                │  │
│  │  0,1  1,1  2,1  3,1 ...     │  │   - Дуэлянт перемещается │  │
│  │  ...                        │  │   - Лучник атакует       │  │
│  │  0,9  1,9  2,9  3,9 ...     │  │   ...                    │  │
│  │                             │  │                          │  │
│  └─────────────────────────────┘  └──────────────────────────┘  │
│                                                                 │
├─────────────────────────────────────────────────────────────────┤
│ Controls: ⏮️ ⏪ ▶️ ⏩ ⏭️ | Скорость: 0.5x 1x 2x 4x | ⌨️ Клавиши │
│ Progress: Событие 30 из 56 ═══════════════════════════ 54%     │
└─────────────────────────────────────────────────────────────────┘
```

---

## Выявленные проблемы

### 1. 🔴 Координаты на клетках (Высокий приоритет)

**Проблема:** На каждой клетке отображаются координаты (0,0), (1,0) и т.д.

**Анализ:**
- Координаты занимают визуальное пространство и создают шум
- Для пользователя координаты не несут практической ценности во время просмотра боя
- Координаты полезны только для отладки или понимания механики движения
- Визуально загромождают поле боя, особенно на мобильных устройствах

**Рекомендация:** 
- Убрать координаты по умолчанию
- Добавить опциональный режим "Debug/Developer" для отображения координат
- Альтернатива: показывать координаты только при наведении на клетку

---

### 2. 🔴 Неясно, чей ход (Высокий приоритет)

**Проблема:** Сложно понять, какой юнит сейчас действует и к какой команде он принадлежит.

**Текущее состояние:**
- В Turn Order Bar активный юнит подсвечивается жёлтой рамкой
- В журнале событий нет визуального разделения по командам
- На поле боя нет индикатора "сейчас ходит"

**Рекомендации:**
1. **Индикатор активного юнита на поле:**
   - Добавить пульсирующую рамку вокруг юнита, который сейчас действует
   - Показывать стрелку или маркер "▶" над активным юнитом

2. **Цветовое кодирование в журнале событий:**
   - Добавить цветную полоску слева от события (синяя = игрок 1, красная = игрок 2)
   - Или добавить иконку команды перед именем юнита

3. **Улучшить Turn Order Bar:**
   - Разделить юнитов по командам визуально (левая часть = игрок 1, правая = игрок 2)
   - Или добавить цветной фон под группами юнитов

---

### 3. 🟡 Журнал событий требует ручной прокрутки (Средний приоритет)

**Проблема:** При автовоспроизведении журнал не прокручивается автоматически к текущему событию.

**Рекомендации:**
1. Автоматическая прокрутка к текущему событию при воспроизведении
2. Кнопка "Следить за событиями" (toggle) для включения/выключения автопрокрутки
3. При ручной прокрутке пользователем — отключать автопрокрутку

---

### 4. 🟡 Информация о командах недостаточно наглядна (Средний приоритет)

**Проблема:** В header показаны только имена игроков, но нет информации о составе команд.

**Рекомендации:**
1. Добавить панели команд по бокам поля боя:
   ```
   ┌──────────┐  ┌─────────────────┐  ┌──────────┐
   │ Команда 1│  │   Поле боя      │  │ Команда 2│
   │ 🛡️ Knight│  │                 │  │ 🏹 Archer│
   │ ⚔️ Rogue │  │                 │  │ 🔮 Mage  │
   │ ...      │  │                 │  │ ...      │
   └──────────┘  └─────────────────┘  └──────────┘
   ```

2. Показывать состав команд с текущим HP каждого юнита
3. Визуально отмечать погибших юнитов (перечёркнутые или серые)

---

### 5. 🟡 Размер клеток и юнитов (Средний приоритет)

**Текущее состояние:** Клетки 48x48px (w-12 h-12)

**Анализ:**
- На десктопе размер адекватный
- На мобильных устройствах поле может быть слишком маленьким
- HP-бар юнита очень тонкий (1px), сложно разглядеть

**Рекомендации:**
1. Увеличить HP-бар до 2-3px
2. Добавить адаптивный размер клеток для мобильных устройств
3. Рассмотреть возможность зума поля боя

---

### 6. 🟢 Улучшения визуализации событий (Низкий приоритет)

**Рекомендации:**
1. **Линии атаки:** При атаке показывать линию от атакующего к цели
2. **Путь движения:** При перемещении показывать пунктирную линию пути
3. **Эффекты урона:** Более заметные числа урона над юнитами
4. **Звуковые эффекты:** Опциональные звуки для атак, смертей, способностей

---

### 7. 🟢 Дополнительные улучшения (Низкий приоритет)

1. **Мини-карта:** Для быстрой навигации по полю боя
2. **Статистика боя:** Панель с общим уроном, лечением, убийствами по командам
3. **Таймлайн раундов:** Визуальная шкала раундов для быстрой навигации
4. **Режим замедленного воспроизведения:** Для ключевых моментов (убийства, способности)

---

## Приоритетный план улучшений

### Фаза 1: Критические улучшения
1. ✅ Убрать координаты с клеток (или сделать опциональными)
2. ✅ Добавить индикатор активного юнита на поле боя
3. ✅ Цветовое кодирование событий по командам в журнале

### Фаза 2: Улучшение UX
4. Автопрокрутка журнала событий
5. Панели команд по бокам поля боя
6. Увеличить HP-бар юнитов

### Фаза 3: Полировка
7. Линии атаки и пути движения
8. Статистика боя
9. Адаптивный дизайн для мобильных

---

## Примеры реализации

### Индикатор активного юнита
```tsx
// В ReplayGridCell добавить:
{unit && unit.alive && isActiveUnit && (
  <div className="absolute -inset-1 border-2 border-yellow-400 rounded animate-pulse" />
)}
```

### Цветовое кодирование в журнале
```tsx
// В EventLog добавить индикатор команды:
const getTeamIndicator = (actorId: string) => {
  const unit = units.find(u => u.instanceId === actorId);
  if (!unit) return null;
  return (
    <span className={`inline-block w-2 h-2 rounded-full mr-2 ${
      unit.team === 'player1' ? 'bg-blue-500' : 'bg-red-500'
    }`} />
  );
};
```

### Автопрокрутка журнала
```tsx
// В EventLog добавить ref и useEffect:
const currentEventRef = useRef<HTMLDivElement>(null);

useEffect(() => {
  if (autoScroll && currentEventRef.current) {
    currentEventRef.current.scrollIntoView({ 
      behavior: 'smooth', 
      block: 'center' 
    });
  }
}, [currentEventIndex, autoScroll]);
```

---

## Заключение

Основные проблемы связаны с:
1. **Визуальным шумом** (координаты на клетках)
2. **Недостаточной обратной связью** (неясно, чей ход)
3. **Отсутствием автоматизации** (ручная прокрутка журнала)

Рекомендуется начать с Фазы 1, так как эти изменения дадут наибольший эффект при минимальных затратах на разработку.
