# Mobile Access Setup Guide

## Настройка доступа с мобильного телефона

### Шаг 1: Определите IP-адрес вашего компьютера

Откройте командную строку (cmd) и выполните:
```bash
ipconfig
```

Найдите ваш локальный IP-адрес (обычно начинается с 192.168.x.x):
- **Ethernet adapter** или **Wireless LAN adapter Wi-Fi**
- Строка **IPv4 Address**: например, `192.168.68.101`

### Шаг 2: Создайте файл конфигурации

В папке `frontend/` создайте файл `.env.local`:
```bash
NEXT_PUBLIC_API_URL=http://192.168.68.101:3004
```
**Замените `192.168.68.101` на ваш реальный IP-адрес!**

### Шаг 3: Настройте Windows Firewall

Откройте PowerShell от имени администратора и выполните:

```powershell
# Разрешить входящие подключения на порт 3000 (Frontend)
New-NetFirewallRule -DisplayName "Next.js Dev Server" -Direction Inbound -LocalPort 3000 -Protocol TCP -Action Allow

# Разрешить входящие подключения на порт 3004 (Backend)
New-NetFirewallRule -DisplayName "NestJS Backend" -Direction Inbound -LocalPort 3004 -Protocol TCP -Action Allow
```

### Шаг 4: Запустите серверы

**Backend (в папке backend/):**
```bash
npm run start:dev
```

**Frontend (в папке frontend/):**
```bash
npm run dev
```

Вы увидите:
- Backend: `Backend running on http://0.0.0.0:3004 (accessible from network)`
- Frontend: `- Local: http://localhost:3000` и `- Network: http://192.168.68.101:3000`

### Шаг 5: Подключитесь с телефона

1. Убедитесь, что телефон подключен к **той же Wi-Fi сети**, что и компьютер
2. Откройте браузер на телефоне
3. Перейдите по адресу: `http://192.168.68.101:3000` (замените на ваш IP)

## Проверка подключения

### Проверка с компьютера:
```bash
# Проверьте, что серверы слушают на всех интерфейсах
netstat -an | findstr "3000 3004"
```

Должны быть строки:
- `TCP    0.0.0.0:3000           0.0.0.0:0              LISTENING`
- `TCP    0.0.0.0:3004           0.0.0.0:0              LISTENING`

### Проверка с телефона:
1. Откройте `http://ВАШ_IP:3004/api/docs` - должна открыться Swagger документация
2. Откройте `http://ВАШ_IP:3000` - должна открыться главная страница игры

## Возможные проблемы

### Проблема: "Не удается подключиться"
**Решение:**
- Проверьте, что оба устройства в одной Wi-Fi сети
- Проверьте правила Firewall (см. Шаг 3)
- Убедитесь, что серверы запущены
- Попробуйте временно отключить антивирус

### Проблема: "API недоступен"
**Решение:**
- Проверьте файл `frontend/.env.local` - IP должен совпадать с вашим
- Перезапустите frontend после изменения `.env.local`
- Проверьте, что backend запущен и доступен

### Проблема: "CORS ошибка"
**Решение:**
- Убедитесь, что изменения в `backend/src/main.ts` применены
- Перезапустите backend сервер

## Отмена изменений (возврат к localhost)

Если хотите вернуться к работе только на localhost:

1. Удалите файл `frontend/.env.local`
2. Или измените его содержимое на:
   ```bash
   NEXT_PUBLIC_API_URL=http://localhost:3004
   ```
3. Перезапустите frontend

## Технические детали

### Что было изменено:

1. **frontend/package.json**: `next dev` → `next dev -H 0.0.0.0`
   - Frontend теперь слушает на всех сетевых интерфейсах

2. **backend/src/main.ts**: `app.listen(3004)` → `app.listen(3004, '0.0.0.0')`
   - Backend теперь слушает на всех сетевых интерфейсах
   - CORS настроен на `origin: true` для разработки

3. **frontend/src/lib/api.ts**: Добавлена поддержка `NEXT_PUBLIC_API_URL`
   - API клиент использует переменную окружения для URL бэкенда

4. **Windows Firewall**: Добавлены правила для портов 3000 и 3004
   - Разрешены входящие TCP подключения

### Безопасность

⚠️ **Важно**: Эти настройки предназначены только для разработки!
- Не используйте `origin: true` в продакшене
- Не открывайте порты в публичных сетях
- Используйте только в доверенных Wi-Fi сетях
